<!DOCTYPE html>
<html>
<head>
  <!-- © 2026 Subramaniyam Pooni | CS²B Technologies (CSSQUAREDB Technologies) | All Rights Reserved -->
  <meta charset="UTF-8">
  <meta name="author" content="Subramaniyam Pooni">
  <meta name="company" content="CS²B Technologies (CSSQUAREDB Technologies)">
  <title>KV Cache and Batching</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="margin:0; background:#000">
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    const data = {
      'kv-what': { title: 'WHAT IS KV CACHE?', desc: 'Store computed key-value pairs to avoid recomputation. Without cache you recompute K,V for entire sequence each step. With cache, 10-100x speedup.' },
      'kv-memory': { title: 'KV CACHE MEMORY', desc: 'KV cache can be massive. LLaMA-7B with 2048 seq = ~1GB. LLaMA-70B with 4096 seq and batch 8 = ~50GB! Often larger than model weights.' },
      'paged': { title: 'PAGED ATTENTION', desc: 'vLLM key innovation. Virtual memory for KV cache. Divide into fixed-size blocks, allocate on demand. Result: ~4x more sequences in same memory.' },
      'continuous': { title: 'CONTINUOUS BATCHING', desc: 'Dynamic batching for high throughput. When sequence finishes, immediately add new one. No waiting for slow sequences. Used by vLLM and TGI.' },
      'prefill': { title: 'PREFILL PHASE', desc: 'Process the input prompt. All tokens at once, parallel, compute-bound. Fills the KV cache.' },
      'decode': { title: 'DECODE PHASE', desc: 'Generate output tokens one by one. Sequential, memory-bound. Reads from KV cache. Batching essential.' },
      'ttft': { title: 'TTFT', desc: 'Time To First Token. Queue time + prefill time. Key user-perceived latency metric.' },
      'tpot': { title: 'TPOT', desc: 'Time Per Output Token. How fast text streams. Affected by batch size and memory bandwidth.' },
      'prefix': { title: 'PREFIX CACHING', desc: 'Reuse KV cache for common prefixes like system prompts. 100 requests sharing 1000 token prefix = 100x savings on that prefix.' },
      'mqa': { title: 'MQA / GQA', desc: 'Multi-Query and Grouped-Query Attention. Share K,V heads across Q heads. 8-16x KV cache reduction. LLaMA 2 70B uses GQA.' },
      'vllm': { title: 'vLLM', desc: 'State-of-the-art serving. PagedAttention + Continuous batching + CUDA graphs. 2-4x throughput vs HuggingFace.' },
      'throughput': { title: 'THROUGHPUT', desc: 'Tokens per second total. Throughput = batch_size * tokens_per_request. Maximize tokens/$/hour.' },
      'latency': { title: 'LATENCY', desc: 'Time per request. Queue + TTFT + generation. Higher batch = higher latency. Balance with SLO.' }
    };

    function App() {
      const [tip, setTip] = useState(null);
      const [pos, setPos] = useState({ x: 0, y: 0 });

      const Box = ({ id, color, children }) => (
        <div
          data-tooltip-id={id}
          
          className={`p-4 rounded-xl border-2 cursor-pointer transition-all hover:scale-105 ${color}`}
        >
          {children}
        </div>
      );

      return (
        <div className="min-h-screen bg-black text-white p-8" onMouseMove={e => { const target = e.target.closest('[data-tooltip-id]'); if (target) { setTip(target.getAttribute('data-tooltip-id')); } else { setTip(null); } setPos({ x: e.clientX, y: e.clientY }); }}>
          {tip && data[tip] && (
            <div 
              className="fixed z-50 w-80 p-4 bg-slate-900 border-2 border-cyan-500 rounded-xl shadow-xl"
              style={{ right: 20, bottom: 20 }}
            >
              <div className="text-cyan-300 font-bold mb-2">{data[tip].title}</div>
              <div className="text-slate-300 text-sm">{data[tip].desc}</div>
            </div>
          )}

          <div className="max-w-5xl mx-auto">
            <header className="text-center mb-10">
              <div className="inline-block px-4 py-1 bg-cyan-900/50 border border-cyan-500 rounded-full mb-4">
                <span className="text-cyan-300 font-bold text-sm">INFERENCE OPTIMIZATION</span>
              </div>
              <h1 className="text-5xl font-black mb-2 bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent">
                KV Cache and Batching
              </h1>
              <p className="text-slate-400">How vLLM achieves 2-4x throughput. Hover for details.</p>
            </header>

            <section className="mb-8">
              <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <span className="w-8 h-8 rounded bg-purple-600 flex items-center justify-center text-sm">1</span>
                KV Cache Basics
              </h2>
              <div className="grid grid-cols-2 gap-4">
                <Box id="kv-what" color="bg-purple-900/40 border-purple-500">
                  <div className="font-bold text-purple-200">What is KV Cache?</div>
                  <div className="text-purple-200/60 text-sm">Store K,V to avoid recompute</div>
                </Box>
                <Box id="kv-memory" color="bg-purple-900/40 border-purple-500">
                  <div className="font-bold text-purple-200">Memory Cost</div>
                  <div className="text-purple-200/60 text-sm">Often larger than weights!</div>
                </Box>
              </div>
            </section>

            <section className="mb-8">
              <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <span className="w-8 h-8 rounded bg-blue-600 flex items-center justify-center text-sm">2</span>
                PagedAttention and Batching
              </h2>
              <div className="grid grid-cols-2 gap-4">
                <Box id="paged" color="bg-blue-900/40 border-blue-500">
                  <div className="font-bold text-blue-200">PagedAttention</div>
                  <div className="text-blue-200/60 text-sm">Virtual memory for KV cache</div>
                </Box>
                <Box id="continuous" color="bg-blue-900/40 border-blue-500">
                  <div className="font-bold text-blue-200">Continuous Batching</div>
                  <div className="text-blue-200/60 text-sm">Dynamic add/remove sequences</div>
                </Box>
              </div>
            </section>

            <section className="mb-8">
              <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <span className="w-8 h-8 rounded bg-orange-600 flex items-center justify-center text-sm">3</span>
                Prefill vs Decode
              </h2>
              <div className="grid grid-cols-4 gap-3">
                <Box id="prefill" color="bg-orange-900/40 border-orange-500">
                  <div className="font-bold text-orange-200 text-sm">Prefill</div>
                  <div className="text-orange-200/60 text-xs">Process prompt</div>
                </Box>
                <Box id="decode" color="bg-orange-900/40 border-orange-500">
                  <div className="font-bold text-orange-200 text-sm">Decode</div>
                  <div className="text-orange-200/60 text-xs">Generate tokens</div>
                </Box>
                <Box id="ttft" color="bg-orange-900/40 border-orange-500">
                  <div className="font-bold text-orange-200 text-sm">TTFT</div>
                  <div className="text-orange-200/60 text-xs">Time to first token</div>
                </Box>
                <Box id="tpot" color="bg-orange-900/40 border-orange-500">
                  <div className="font-bold text-orange-200 text-sm">TPOT</div>
                  <div className="text-orange-200/60 text-xs">Time per token</div>
                </Box>
              </div>
            </section>

            <section className="mb-8">
              <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <span className="w-8 h-8 rounded bg-red-600 flex items-center justify-center text-sm">4</span>
                Optimizations
              </h2>
              <div className="grid grid-cols-2 gap-4">
                <Box id="prefix" color="bg-red-900/40 border-red-500">
                  <div className="font-bold text-red-200">Prefix Caching</div>
                  <div className="text-red-200/60 text-sm">Reuse common prefixes</div>
                </Box>
                <Box id="mqa" color="bg-red-900/40 border-red-500">
                  <div className="font-bold text-red-200">MQA / GQA</div>
                  <div className="text-red-200/60 text-sm">Shared K,V heads</div>
                </Box>
              </div>
            </section>

            <section className="mb-8">
              <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <span className="w-8 h-8 rounded bg-green-600 flex items-center justify-center text-sm">5</span>
                vLLM and Metrics
              </h2>
              <div className="grid grid-cols-3 gap-4">
                <Box id="vllm" color="bg-green-900/40 border-green-500">
                  <div className="font-bold text-green-200">vLLM</div>
                  <div className="text-green-200/60 text-sm">2-4x throughput</div>
                </Box>
                <Box id="throughput" color="bg-green-900/40 border-green-500">
                  <div className="font-bold text-green-200">Throughput</div>
                  <div className="text-green-200/60 text-sm">Tokens/sec total</div>
                </Box>
                <Box id="latency" color="bg-green-900/40 border-green-500">
                  <div className="font-bold text-green-200">Latency</div>
                  <div className="text-green-200/60 text-sm">Time per request</div>
                </Box>
              </div>
            </section>

            <div className="bg-slate-900/50 border border-cyan-500/30 rounded-xl p-6 text-center">
              <div className="text-xl font-bold text-white mb-2">Summary</div>
              <p className="text-slate-400 text-sm">
                KV cache avoids recomputation. PagedAttention manages memory. Continuous batching maximizes throughput.
              </p>
              <div className="flex justify-center gap-3 mt-4">
                <span className="px-3 py-1 bg-purple-900/50 rounded text-purple-300 text-sm">KV Cache</span>
                <span className="px-3 py-1 bg-blue-900/50 rounded text-blue-300 text-sm">PagedAttention</span>
                <span className="px-3 py-1 bg-green-900/50 rounded text-green-300 text-sm">Continuous Batching</span>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
  <div id="cs2b-copyright-footer" style="position:fixed;bottom:0;left:0;right:0;background:linear-gradient(to right,#0f172a,#1e1b4b);border-top:1px solid #334155;padding:8px 16px;font-family:monospace;font-size:11px;color:#64748b;display:flex;justify-content:space-between;align-items:center;z-index:9999;"><span>© 2026 Subramaniyam Pooni</span><span style="color:#8b5cf6;">CS²B Technologies</span><span style="color:#475569;">Enterprise AI Agent Development &amp; LLMOps</span></div>
<div id="cs2b-watermark" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-35deg);pointer-events:none;z-index:9998;white-space:nowrap;user-select:none;text-align:center;"><div style="font-size:100px;font-weight:900;font-family:Arial,sans-serif;color:rgba(139,92,246,0.06);">CS²B Technologies</div><div style="font-size:40px;font-weight:700;font-family:Arial,sans-serif;color:rgba(139,92,246,0.05);">© Subramaniyam Pooni</div></div>
</body>
</html>
